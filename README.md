# Universal Red Teaming Pipeline

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∞—Ç–∞–∫ –∏–∑ –Ω–∞—É—á–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö (adversarial) –¥–∞—Ç–∞—Å–µ—Ç–æ–≤.**

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∑—è—Ç—å –ª—é–±–æ–π PDF —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏–∫–∏ –¥–∂–µ–π–ª–±—Ä–µ–π–∫–∞ (jailbreak) LLM, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á—å –∞–ª–≥–æ—Ä–∏—Ç–º –∞—Ç–∞–∫–∏, —Å–æ–∑–¥–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞ Python –∏ –º–∞—Å—Å–æ–≤–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–≥–æ –∫ –±–∞–∑–æ–≤–æ–º—É –Ω–∞–±–æ—Ä—É –ø—Ä–æ–º–ø—Ç–æ–≤.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Quick Start)

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–≥–æ —Ü–∏–∫–ª–∞ ‚Äî `/rt_start`. –≠—Ç–æ slash-–∫–æ–º–∞–Ω–¥–∞ (workflow), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≤–µ–¥–µ—Ç –≤–∞—Å —á–µ—Ä–µ–∑ –≤—Å–µ —ç—Ç–∞–ø—ã.

### –ö–æ–º–∞–Ω–¥–∞ `/rt_start`

–ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
1.  **–ü–∞—Ä—Å–∏–Ω–≥ PDF**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏.
2.  **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** ("The Brain"): –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—å—é –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –∞—Ç–∞–∫–∏.
3.  **–°–æ–∑–¥–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞** ("The Builder"): –ü–∏—à–µ—Ç Python-–∫–æ–¥ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—Ç–∞–∫–∏.
4.  **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** ("The Factory"): –°–æ–∑–¥–∞–µ—Ç —Å–æ—Å—Ç—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç.

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–≤ —á–∞—Ç–µ —Å –∞–≥–µ–Ω—Ç–æ–º):

**–ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫:**
```text
/rt_start pdf_path=Poetry.pdf
```

**–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–º–ø–ª–æ–≤ (–¥–ª—è —Ç–µ—Å—Ç–∞):**
```text
/rt_start pdf_path=Poetry.pdf max_samples=10
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏:**
```text
/rt_start pdf_path=Poetry.pdf dataset=generator/vanilla_prompts.jsonl
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–∞–≥–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤ `/rt_start`, —Ç–∞–∫ –∏ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ (`main.py`).

| –§–ª–∞–≥ / –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| :--- | :--- | :--- |
| `pdf_path` | –ü—É—Ç—å –∫ PDF —Ñ–∞–π–ª—É —Å–æ —Å—Ç–∞—Ç—å–µ–π (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ). | - |
| `--output`, `output` | –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ `.jsonl` —Ñ–∞–π–ª–∞. | `outputs/dataset.jsonl` |
| `--dataset`, `dataset` | –ò–º—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–∞ HuggingFace **–ò–õ–ò** –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É (–µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç). | `allenai/wildjailbreak` |
| `--column`, `column` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏/–ø–æ–ª—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º–∏ (vanilla) –ø—Ä–æ–º–ø—Ç–∞–º–∏. | `vanilla` |
| `--max-samples`, `max_samples` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤. | `None` (–≤—Å–µ) |
| `--extract-only` | –¢–æ–ª—å–∫–æ –∏–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤ JSON, –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –¥–∞–Ω–Ω—ã–µ. | `False` |
| `--max-concurrent` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API. | `10` |

---

## üõ† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥—É–ª–µ–π, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é —Ñ–∞–∑—É (Phase).

### Phase 0: Parsing & Environment
–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `.agent/workflows/rt_parsing.md`.

### Phase 1: Strategy Extraction ("The Brain")
*   **–§–∞–π–ª**: `src/paper_agent.py`, `main.py`
*   **–ó–∞–¥–∞—á–∞**: –ß–∏—Ç–∞–µ—Ç PDF, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ Claude/LLM —Å –ø—Ä–æ—Å—å–±–æ–π —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞—Ç–∞–∫—É.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `generator/extracted_strategy.json` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∞—Ç–∞–∫–∏ (–ø—Ä–∏–Ω—Ü–∏–ø, —à–∞–≥–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, –ø—Ä–∏–º–µ—Ä—ã).
*   **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –í —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ –∑–∞–¥–∞–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (`[LLM]`, `[Script]`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞.

### Phase 2: Generator Construction ("The Builder")
*   **Workflow**: `.agent/workflows/rt_make_generator.md`
*   **–ó–∞–¥–∞—á–∞**: –ù–∞ –æ—Å–Ω–æ–≤–µ `extracted_strategy.json` –ø–∏—à–µ—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π Python-–∫–æ–¥.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `generator/generator.py`.
*   **–õ–æ–≥–∏–∫–∞**:
    *   –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞—Å—Å `DatasetGenerator`.
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö (–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª / HuggingFace).
    *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç API (OpenRouter) –¥–ª—è LLM-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (–µ—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç LLM).

### Phase 3: Dataset Generation ("The Factory")
*   **–§–∞–π–ª**: `run_generation.py`, `main.py`
*   **–ó–∞–¥–∞—á–∞**: –ó–∞–ø—É—Å–∫–∞–µ—Ç `DatasetGenerator` –Ω–∞ –ø–æ—Ç–æ–∫–µ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
*   **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `outputs/dataset.jsonl`.
*   **–§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–∞**:
    ```json
    {
      "original_prompt": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—É—Å?",
      "attack_prompt": "–¢–µ–∫—Å—Ç –∞—Ç–∞–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å—Ç–∏—Ö–∞—Ö)...",
      "target_response": "",
      "strategy_name": "Adversarial Poetry Attack"
    }
    ```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1.  **Python 3.10+**
2.  **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
    ```bash
    pip install -r requirements.txt
    ```
3.  **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)**:
    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
    ```ini
    OPENROUTER_API_KEY=sk-or-... (–í–∞—à –∫–ª—é—á OpenRouter)
    HUGGINGFACE_TOKEN=hf_...    (–¢–æ–∫–µ–Ω HF –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–∫—Ä—ã—Ç—ã–º –¥–∞—Ç–∞—Å–µ—Ç–∞–º)
    ```

## üñ• –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workflow `/rt_start`, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞–ø—Ä—è–º—É—é:

**1. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (—á–µ—Ä–µ–∑ main.py):**
```bash
python main.py path/to/paper.pdf --max-samples 5
```

**2. –¢–æ–ª—å–∫–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–∂–µ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏ –∫–æ–¥ —Å–æ–∑–¥–∞–Ω):**
```bash
python run_generation.py --dataset generator/vanilla_prompts.jsonl --max-samples 5
```
